<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Well Circle - Mental Health Community</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <script src="https://unpkg.com/@tailwindcss/browser@4"></script>
  <style>
    a { text-decoration: none; color: black; }
  </style>
</head>

<body class="bg-gray-50">
  <div class="max-w-xl mx-auto mt-10 p-6 bg-white rounded shadow-lg">
    <h1 class="text-3xl font-bold text-center mb-6">Mental Health Self-Assessment Quiz</h1>
    <div id="quiz-container"></div>
    <div class="flex justify-between mt-6">
      <button id="back-btn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Back</button>
      <button id="next-btn" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Next</button>
    </div>
  </div>

  <div id="result" class="max-w-xl mx-auto p-6 mt-6 bg-green-100 border border-green-400 text-green-700 rounded hidden"></div>

  <script>
    const quizData = [
      { "id": 1, "question": "How often do you feel overwhelmed or stressed?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Often", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]},
      { "id": 2, "question": "How well are you able to manage your daily responsibilities?", "options": [
        { "text": "Very well", "score": 0 },
        { "text": "Somewhat well", "score": 1 },
        { "text": "Struggling", "score": 2 },
        { "text": "Not managing at all", "score": 3 }
      ]},
      { "id": 3, "question": "How often do you experience anxiety or worry?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Frequently", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]},
      { "id": 4, "question": "Do you struggle with low mood or lack of motivation?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Occasionally", "score": 1 },
        { "text": "Often", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]},
      { "id": 5, "question": "How well do you sleep?", "options": [
        { "text": "Very well", "score": 0 },
        { "text": "Somewhat well", "score": 1 },
        { "text": "Often struggle with sleep", "score": 2 },
        { "text": "Rarely get restful sleep", "score": 3 }
      ]},
      { "id": 6, "question": "Do you find joy or pleasure in activities you used to enjoy?", "options": [
        { "text": "Yes, most of the time", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Rarely", "score": 2 },
        { "text": "Not at all", "score": 3 }
      ]},
      { "id": 7, "question": "How often do you feel isolated or lonely?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Often", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]},
      { "id": 8, "question": "How often do you have difficulty concentrating or making decisions?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Often", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]},
      { "id": 9, "question": "How often do you feel irritable or frustrated?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Often", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]},
      { "id": 10, "question": "How often do you feel hopeless or helpless?", "options": [
        { "text": "Rarely or never", "score": 0 },
        { "text": "Sometimes", "score": 1 },
        { "text": "Often", "score": 2 },
        { "text": "Almost always", "score": 3 }
      ]}
    ];
    
    const resultsMapping = [
      { range: [0, 5], message: "Your mental well-being is stable.", resources: ["Join a community to connect with others", "Explore support and resources"] },
      { range: [6, 12], message: "You may benefit from stress management techniques.", resources: ["Join a community to connect with others", "Connect with a professional counselor"] },
      { range: [13, 20], message: "Ongoing struggles suggest seeking additional support.", resources: ["Join a community to connect with others", "Connect with a professional counselor"] },
      { range: [21, 30], message: "Consider speaking with a professional counselor.", resources: ["Join a community to connect with others", "Connect with a professional counselor"] }
    ];

    let currentQuestionIndex = 0;
    let totalScore = 0;
    let userAnswers = Array(quizData.length).fill(null);

    function renderQuestion() {
      const questionData = quizData[currentQuestionIndex];
      let html = `<p class='text-xl mb-4'>${questionData.question}</p>`;
      questionData.options.forEach((option, index) => {
        html += `<div class='mb-2'><input type='radio' name='question' value='${option.score}' class='mr-2'> ${option.text}</div>`;
      });
      $('#quiz-container').html(html);
      $('#back-btn').toggle(currentQuestionIndex > 0);
      $('#next-btn').text(currentQuestionIndex === quizData.length - 1 ? "Submit" : "Next");
    }

    function saveAnswer() {
      const selectedOption = $('input[name="question"]:checked').val();
      if (selectedOption === undefined) {
        alert("Please select an option before proceeding.");
        return false;
      }
      userAnswers[currentQuestionIndex] = parseInt(selectedOption);
      return true;
    }

    function calculateResult() {
      totalScore = userAnswers.reduce((a, b) => a + b, 0);
      let result = resultsMapping.find(res => totalScore >= res.range[0] && totalScore <= res.range[1]);
      $('#result').html(`<h2 class='text-xl font-bold mb-2'>${result.message}</h2><ul class='list-disc pl-5'><li>${result.resources.join('</li><li>')}</li></ul>`).removeClass('hidden');
      $('#next-btn').hide();
      $('#back-btn').hide();
      $('#result').append(`<div class='mt-4'><button class='bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' onclick='location.reload()'>Retake Quiz</button></div>`);
    }

    $(document).ready(() => {
      renderQuestion();

      $('#next-btn').off('click').on('click', function() {
        if (!saveAnswer()) return;
        if (currentQuestionIndex < quizData.length - 1) {
          currentQuestionIndex++;
          renderQuestion();
        } else {
          $('.max-w-xl').hide();
          calculateResult();
        }
      });

      $('#back-btn').off('click').on('click', function() {
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          renderQuestion();
        }
      });
    });
  </script>
</body>

</html>